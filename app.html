<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Resume Builder (Standalone)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
    :root { --ink:#0f172a; --muted:#475569; --accent:#6366f1; }
    body{ font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,sans-serif; background:#f7f9fb; color:var(--ink); }

    /* ===== Toolbar / Layout ===== */
    .toolbar{ position:sticky; top:0; z-index:20; background:linear-gradient(180deg,#ffffff,rgba(255,255,255,.9)); backdrop-filter:saturate(180%) blur(4px); border-bottom:1px solid #e2e8f0;}
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:.5rem; border-radius:.8rem; padding:.7rem 1rem; font-weight:600; box-shadow:0 1px 1px rgba(2,6,23,.06),0 1px 2px rgba(2,6,23,.06);}
    .btn-primary{ background:linear-gradient(90deg,#7c3aed,#6366f1); color:#fff; }
    .btn-primary:hover{ filter:brightness(1.05); }
    .btn-ghost{ background:#fff; border:1px solid #e2e8f0; color:#111827; }
    .card{ background:#fff; border:1px solid #e2e8f0; border-radius:1rem; box-shadow:0 10px 20px -12px rgba(2,6,23,.10); }

    /* ===== Resume Sheet (preview + print) ===== */
    .sheet{
      width:8.5in; min-height:11in; margin:0 auto; background:#fff; padding:.55in;
      overflow-wrap:anywhere; hyphens:auto; border-radius:0.75rem; /* match card corners */
    }
    .a4 .sheet{ width:8.27in; min-height:11.69in; }

    .sheet h1{ font-size:1.9rem; font-weight:800; margin:0 0 .25rem 0; }
    .sheet h2{ font-size:1.05rem; font-weight:800; letter-spacing:.02em; margin:1rem 0 .4rem; }
    .sheet p{ margin:.25rem 0; line-height:1.5; }
    .sheet ul{ list-style:disc; margin:.25rem 0 .35rem 1.2rem; }
    .sheet li{ margin:.2rem 0; }
    .sheet h1,.sheet h2{ break-after:avoid; page-break-after:avoid; }
    .block,.sheet ul,.sheet li{ break-inside:avoid; page-break-inside:avoid; }

    /* Preview card should scroll instead of leaking beyond rounded border */
    .preview-card{ overflow:auto !important; }

    /* Print settings */
    @page { size: 8.5in 11in; margin: .5in; }
    .a4 @page { size: A4; margin: .5in; }

    @media print{
      html,body{ background:#fff; height:auto; }
      #appContainer,.card{ padding:0 !important; margin:0 !important; border:none !important; box-shadow:none !important; }
      .toolbar,#inputArea,.preview-title-bar{ display:none !important; } /* hide top UI + ‚ÄúResume Preview‚Äù bar */
      .sheet{ width:auto !important; min-height:auto !important; padding:0 !important; border-radius:0 !important; }
    }

    /* Slightly tighter spacing during print */
    .for-print .sheet{ font-size:0.97rem; padding:.5in; }

    /* Spinner */
    .spinner{ border:4px solid rgba(0,0,0,.08); border-top:4px solid var(--accent); border-radius:50%; width:24px; height:24px; animation:spin 1s linear infinite }
    @keyframes spin{ 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }

    /* Inline edit highlight */
    .editable-active{ outline:2px dashed #a78bfa; outline-offset:6px; }
  </style>
</head>
<body>
  <div class="toolbar">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="font-bold text-slate-800">AI Resume Builder</div>
      <div class="flex gap-2">
        <button id="editBtn" class="btn btn-ghost">Edit</button>
        <button id="downloadBtn" class="btn btn-primary">Download PDF</button>
        <select id="paperSelect" class="btn btn-ghost px-3">
          <option value="letter">US Letter</option>
          <option value="a4">A4</option>
        </select>
      </div>
    </div>
  </div>

  <div id="appContainer" class="max-w-6xl mx-auto p-4 md:p-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div id="inputArea" class="card p-6">
      <h2 class="text-xl font-bold mb-1">Your Details</h2>
      <p class="text-slate-600 mb-4">Fill these and generate. PDF layout is optimized to fit one page.</p>

      <form id="resumeForm" class="space-y-5">
        <div class="grid grid-cols-1 gap-3">
          <label class="text-sm font-semibold">Full Name
            <input id="fullName" class="mt-1 w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-200" placeholder="Jane Doe" required>
          </label>
          <label class="text-sm font-semibold">Contact (Email ¬∑ Phone ¬∑ LinkedIn ¬∑ City)
            <input id="contactInfo" class="mt-1 w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-200" placeholder="jane@ex.com ¬∑ (555) 123-4567 ¬∑ linkedin.com/in/jane ¬∑ Miami" required>
          </label>
        </div>

        <div class="grid grid-cols-1 gap-3">
          <label class="text-sm font-semibold">Target Role
            <input id="targetRole" class="mt-1 w-full p-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-200" placeholder="Software Engineer" required>
          </label>
          <label class="text-sm font-semibold">Professional Summary
            <textarea id="summary" rows="3" class="mt-1 w-full p-3 border rounded-xl focus:ring-2 focus:ring-indigo-200" placeholder="1‚Äì3 lines highlighting your strengths"></textarea>
          </label>
        </div>

        <label class="text-sm font-semibold block">Experience
          <textarea id="experience" rows="6" class="mt-1 w-full p-3 border rounded-xl focus:ring-2 focus:ring-indigo-200" placeholder="Roles ¬∑ Companies ¬∑ Dates ¬∑ Achievements" required></textarea>
        </label>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <label class="text-sm font-semibold">Education
            <textarea id="education" rows="3" class="mt-1 w-full p-3 border rounded-xl focus:ring-2 focus:ring-indigo-200" placeholder="Degree ¬∑ Institution ¬∑ Year" required></textarea>
          </label>
          <label class="text-sm font-semibold">Key Skills
            <textarea id="skills" rows="3" class="mt-1 w-full p-3 border rounded-xl focus:ring-2 focus:ring-indigo-200" placeholder="Python, React, SQL, ‚Ä¶" required></textarea>
          </label>
        </div>

        <div class="flex gap-3">
          <button type="submit" id="generateButton" class="btn btn-primary flex-1">Generate</button>
          <button type="button" id="clearBtn" class="btn btn-ghost">Clear</button>
        </div>

        <div id="errorMessage" class="hidden mt-2 p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg text-sm"></div>
      </form>
    </div>

    <div class="card p-0 relative preview-card">
      <div class="px-6 pt-4 pb-2 border-b preview-title-bar">
        <h2 class="text-lg font-semibold">Resume Preview</h2>
        <p id="statusMessage" class="text-slate-500 text-sm">Your resume will appear here after you click Generate.</p>
      </div>

      <div id="loadingIndicator" class="hidden absolute inset-0 bg-white/70 backdrop-blur-[1px] z-10 flex items-center justify-center">
        <div class="spinner"></div>
      </div>

      <div class="p-4">
        <div id="resumeOutput" class="sheet" contenteditable="false"></div>
      </div>
    </div>
  </div>

  <script>
    // üõë IMPORTANT: REPLACE THIS PLACEHOLDER WITH YOUR ACTUAL GEMINI API KEY üõë
    const GEMINI_API_KEY = "AIzaSyAtd00tTdc0AiIs4jpjJ6wM1A5HmnB6PaA";
    const GEMINI_MODEL = "gemini-2.0-flash"; // Use the general model name for client-side API

    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;

    const SYSTEM_PROMPT = `You are a world-class professional resume writer. Generate a polished, modern, high-impact resume in clear Markdown only (no extra prose before/after).
Rules:
1) Use '#' for the full name.
2) Use '##' for section headers (Professional Summary, Experience, Education, Skills).
3) Use '*' bullets for achievements and skills.
4) Use strong action verbs, quantify results, ensure ATS-friendly keywords, inclusive language.
5) Keep it concise and professional.
`;

    // Elements
    const form = document.getElementById("resumeForm");
    const generateButton = document.getElementById("generateButton");
    const loadingIndicator = document.getElementById("loadingIndicator");
    const resumeOutput = document.getElementById("resumeOutput");
    const statusMessage = document.getElementById("statusMessage");
    const errorMessageDiv = document.getElementById("errorMessage");
    const downloadBtn = document.getElementById("downloadBtn");
    const paperSelect = document.getElementById("paperSelect");
    const editBtn = document.getElementById("editBtn");
    let editMode = false;

    // UX clamps so the model doesn‚Äôt overflow tokens
    document.getElementById('summary').maxLength = 1200;
    document.getElementById('experience').maxLength = 4000;
    document.getElementById('education').maxLength = 1200;
    document.getElementById('skills').maxLength = 1200;

    // --- Helper Functions ---

    // Paper size toggle
    paperSelect.addEventListener('change', (e)=>{
      document.documentElement.classList.toggle('a4', e.target.value === 'a4');
    });

    // Print / PDF
    downloadBtn.addEventListener('click', ()=>{
      document.body.classList.add('for-print');
      setTimeout(()=> window.print(), 50);
      setTimeout(()=> document.body.classList.remove('for-print'), 1200);
    });

    // Inline edit toggle
    editBtn.addEventListener('click', ()=>{
      editMode = !editMode;
      resumeOutput.setAttribute('contenteditable', String(editMode));
      resumeOutput.classList.toggle('editable-active', editMode);
      editBtn.textContent = editMode ? 'Finish Editing' : 'Edit';
    });

    // Clear form + preview
    document.getElementById('clearBtn').addEventListener('click', ()=>{
      form.reset();
      resumeOutput.innerHTML = "";
      statusMessage.classList.remove('hidden');
    });

    // Markdown ‚Üí HTML (supports *, -, ‚Ä¢ bullets)
    function markdownToHtml(md) {
      let html = md || "";

      // Headings
      html = html.replace(/^### (.*)$/gm, '<h3 class="font-semibold">$1</h3>');
      html = html.replace(/^## (.*)$/gm, '<h2>$1</h2>');
      html = html.replace(/^# (.*)$/gm, '<h1>$1</h1>');

      // Emphasis
      html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
      html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');

      // Bullets
      html = html.replace(/^(?:\*|-|‚Ä¢)\s+(.*)$/gm, '<li>$1</li>');
      html = html.replace(/(<li>.*<\/li>(?:\n)?)+/g, m => `<ul>${m}</ul>`);

      // Paragraphs
      html = html.split("\n").map(line=>{
        const t=line.trim();
        if(!t || /^<\/?(h\d|ul|li)/.test(t)) return line;
        return `<p>${line}</p>`;
      }).join("\n");

      return html;
    }

    // --- Main API Logic (Moved from Python Backend) ---

    async function callGeminiAPI(userData) {
      if (GEMINI_API_KEY === "YOUR_GEMINI_API_KEY_HERE") {
        throw new Error("API Key Missing. Please replace 'YOUR_GEMINI_API_KEY_HERE' in the script.");
      }
      
      const userQuery = (
          "Generate a resume. Candidate data:\n"
          + `Full Name: ${userData.fullName}\n`
          + `Contact Information: ${userData.contactInfo}\n`
          + `Target Role: ${userData.targetRole}\n`
          + `Professional Summary: ${userData.summary}\n`
          + `Work Experience: ${userData.experience}\n`
          + `Education: ${userData.education}\n`
          + `Key Skills: ${userData.skills}\n`
      );

      const payload = {
  // ‚úÖ CORRECT: systemInstruction is now at the top level
  systemInstruction: { 
    parts: [ { text: SYSTEM_PROMPT } ]
  },
  
  contents: [ {
    role: "user",
    parts: [ { text: userQuery } ]
  } ],
  
  // You already have this, keep it:
  generationConfig: { 
      temperature: 0.4,
      maxOutputTokens: 2048
  }
};

      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      if (!res.ok) {
        let errorDetail;
        try {
          errorDetail = (await res.json()).error.message;
        } catch {
          errorDetail = `HTTP error! Status: ${res.status}`;
        }
        throw new Error(`API Request Failed: ${errorDetail}`);
      }

      const data = await res.json();
      const generatedText = data.candidates?.[0]?.content?.parts?.[0]?.text;

      if (!generatedText) {
        throw new Error("API response was empty or malformed. Check console for details.");
      }
      return generatedText;
    }

    // --- Form Submission ---

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      resumeOutput.innerHTML = "";
      errorMessageDiv.classList.add("hidden");
      statusMessage.classList.add("hidden");
      loadingIndicator.classList.remove("hidden");
      generateButton.disabled = true;
      generateButton.textContent = "Generating‚Ä¶";

      const userData = {
        fullName: document.getElementById("fullName").value.trim(),
        contactInfo: document.getElementById("contactInfo").value.trim(),
        targetRole: document.getElementById("targetRole").value.trim(),
        summary: document.getElementById("summary").value.trim(),
        experience: document.getElementById("experience").value.trim(),
        education: document.getElementById("education").value.trim(),
        skills: document.getElementById("skills").value.trim(),
      };

      try {
        const markdownResume = await callGeminiAPI(userData);
        resumeOutput.innerHTML = markdownToHtml(markdownResume);
      } catch (error) {
        errorMessageDiv.classList.remove("hidden");
        errorMessageDiv.textContent = "Error: " + error.message;
        statusMessage.classList.remove("hidden");
      } finally {
        loadingIndicator.classList.add("hidden");
        generateButton.disabled = false;
        generateButton.textContent = "Generate";
      }
    });

    // --- Initial Data Load (Optional) ---
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('fullName').value = 'Alexandra V. Chen';
        document.getElementById('contactInfo').value = 'alex.chen@example.com | (555) 123-4567 | linkedin.com/in/alexchen';
        document.getElementById('targetRole').value = 'Senior Software Engineer';
        document.getElementById('summary').value = 'Highly results-driven professional with 8+ years of experience in full-stack development, leading cross-functional teams, and successfully launching 4 major software products.';
        document.getElementById('experience').value = `Senior Software Engineer | Innovatech Solutions | 2018 - Present
- Led a team of 5 engineers in the migration of legacy services to AWS Lambda, resulting in a 40% reduction in operating costs.
- Developed and launched a new customer-facing analytics dashboard using React and Python, increasing daily active users by 25k.`;
        document.getElementById('education').value = 'M.S. Computer Science, Stanford University, 2016 | B.S. Electrical Engineering, MIT, 2014';
        document.getElementById('skills').value = 'Python, JavaScript, TypeScript, React, Node.js, AWS (Lambda, S3, EC2), SQL, Agile Methodology, Strategic Planning, Team Leadership';
    });
  </script>
</body>
</html>